



dprive                                                      S. Dickinson
Internet-Draft                                                   Sinodun
Intended status: Standards Track                                T. Reddy
Expires: May 13, 2016                                              Cisco
                                                       November 10, 2015


  Authentication and (D)TLS Profiles forDNS-over-TLS and DNS-over-DTLS
              draft-dr-dprive-profiles-for-tls-and-dtls-01

Abstract

   This document defines profiles for client authentication of DNS
   servers when using Transport Layer Security (TLS) and Datagram TLS
   (DTLS).  Additionally, it defines (D)TLS profiles for DNS clients and
   servers implementing DNS-over-TLS and DNS-over-DTLS.

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at http://datatracker.ietf.org/drafts/current/.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on May 13, 2016.

Copyright Notice

   Copyright (c) 2015 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (http://trustee.ietf.org/license-info) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.



Dickinson & Reddy         Expires May 13, 2016                  [Page 1]

Internet-Draft            (D)TLS Authentication            November 2015


Table of Contents

   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   2
   2.  Requirements Key Words  . . . . . . . . . . . . . . . . . . .   3
   3.  Terminology . . . . . . . . . . . . . . . . . . . . . . . . .   3
   4.  Discussion  . . . . . . . . . . . . . . . . . . . . . . . . .   4
   5.  Opportunistic Privacy Profile . . . . . . . . . . . . . . . .   4
   6.  Strict TLS Profile  . . . . . . . . . . . . . . . . . . . . .   4
   7.  Out of Band Sources of Reference Identifier . . . . . . . . .   5
     7.1.  Direct configuration  . . . . . . . . . . . . . . . . . .   5
     7.2.  DHCP  . . . . . . . . . . . . . . . . . . . . . . . . . .   5
   8.  In Band Sources of Reference Identifier . . . . . . . . . . .   5
     8.1.  DANE  . . . . . . . . . . . . . . . . . . . . . . . . . .   5
       8.1.1.  Direct DNS Lookup . . . . . . . . . . . . . . . . . .   6
       8.1.2.  TLS DNSSEC Chain extension  . . . . . . . . . . . . .   6
   9.  Authentication Profiles . . . . . . . . . . . . . . . . . . .   6
     9.1.  X.509 Certificate Based Authentication  . . . . . . . . .   6
       9.1.1.  Certificate Level Authentication  . . . . . . . . . .   6
       9.1.2.  Field Based Authentication  . . . . . . . . . . . . .   6
         9.1.2.1.  DNS-ID Based Authentication . . . . . . . . . . .   6
         9.1.2.2.  Others... . . . . . . . . . . . . . . . . . . . .   6
     9.2.  Public Key Based Authentication . . . . . . . . . . . . .   7
       9.2.1.  SPKI Based Authentication . . . . . . . . . . . . . .   7
       9.2.2.  Raw Public Key Based Authentication . . . . . . . . .   7
   10. Server capability probing and caching by DNS clients  . . . .   7
   11. (D)TLS Protocol Profile . . . . . . . . . . . . . . . . . . .   7
   12. IANA Considerations . . . . . . . . . . . . . . . . . . . . .   8
   13. Security Considerations . . . . . . . . . . . . . . . . . . .   8
   14. Acknowledgements  . . . . . . . . . . . . . . . . . . . . . .   8
   15. References  . . . . . . . . . . . . . . . . . . . . . . . . .   8
     15.1.  Normative References . . . . . . . . . . . . . . . . . .   8
     15.2.  Informative References . . . . . . . . . . . . . . . . .   9
   Appendix A.  Changes between revisions  . . . . . . . . . . . . .  10
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .  10

1.  Introduction

   To address the concerns in [RFC7626] the DPRIVE working group has two
   active documents that provide DNS privacy:

   o  DNS-over TLS [I-D.ietf-dprive-dns-over-tls]

   o  DNS-over-DTLS [I-D.ietf-dprive-dnsodtls]








Dickinson & Reddy         Expires May 13, 2016                  [Page 2]

Internet-Draft            (D)TLS Authentication            November 2015


   This document defines authentication profiles for DTLS [RFC6347] and
   TLS [RFC5246] that specify how DNS clients should authenticate DNS
   servers.  This draft describes both how DNS clients can obtain
   reference identifiers for DNS servers and how those identifiers
   should be used to authenticate a DNS server.

   The scope of this document is limited to DNS clients authenticating
   Iterative Resolvers.  Authentication of DNS clients by DNS servers is
   out of scope of this document.

   This document also defines a (D)TLS protocol profile for DNS-over-TLS
   and DNS-over-DTLS.  This profile defines the configuration options
   and protocol extensions required to optimize connection establishment
   and resumption, and support the authentication profiles.

2.  Requirements Key Words

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in [RFC2119].

3.  Terminology

   o  Reference identifier: Identifiers which can be obtained by the
      client and are used during authentication: These include

      *  X.509 certificate (entire certificate)

      *  X.509 certificate fingerprint

      *  X.509 certificate fields entries (e.g. dNSName, certificate
         name) for matching

      *  Subject Public Key Info (SPKI) fingerprint

      *  Raw Public Key

   o  Presented identifier: Identifier presented by the server during
      authentication:

      *  X.509 certificate (entire certificate)

      *  Raw Public Key [RFC7250]

   o  DNS privacy sever: A DNS server that

      *  implements DNS-over TLS [I-D.ietf-dprive-dns-over-tls] and/or
         DNS-over-DTLS [I-D.ietf-dprive-dnsodtls]



Dickinson & Reddy         Expires May 13, 2016                  [Page 3]

Internet-Draft            (D)TLS Authentication            November 2015


      *  implements this document

      *  can be authenticated using one of the profiles described in
         this document

4.  Discussion

   DNS privacy requires encrypting the query (and response) to protect
   against passive attacks.  Such encryption typically provides
   integrity protection as a side-effect, which means on-path attackers
   cannot simply inject bogus DNS responses.  However, to provide
   stronger protection from active attackers pretending to be the
   server, the server itself needs to be authenticated.

   Many applications use PKIX authentication [add ref] based on a list
   of acceptable reference identifiers, which are in turn based on the
   source domain [RFC6125].  That source domain is typically obtained
   via DNS.  Therefore DNS is in a rather unique position because this
   trust recursion leads to an authentication bootstrap problem.

   [TODO: More discussion needed....]

5.  Opportunistic Privacy Profile

   An Opportunistic Privacy profile is described in
   [I-D.ietf-dprive-dns-over-tls] which MAY be used for both DNS-over-
   TLS and DNS-over-DTLS.

   When performing opportunistic privacy the client MUST authenticate
   the DNS server using one of of the authentication profiles described
   here.

6.  Strict TLS Profile

   To authenticate the server providing DNS privacy, the DNS client
   needs to be obtain reference identifier(s) for each DNS privacy
   server.  For the strict TLS profile the DNS client MUST use at least
   one of the sources listed in Section 7 and Section 8 to obtain
   reference identifier(s) for available DNS servers.  The client MUST
   only use DNS servers for which at least one reference identifier is
   available.  The client MUST use one of the Authentication Profiles
   described in section Section 9 to authenticate the server.  This
   allows the DNS client to detect on-path attacks.

   [QUESTION: Should we specify some minimum set of requirements here
   with regard to sources/identifiers/auth profiles?]





Dickinson & Reddy         Expires May 13, 2016                  [Page 4]

Internet-Draft            (D)TLS Authentication            November 2015


   With Strict TLS, the DNS client MUST signal to the user when none of
   the DNS privacy servers are available, and MUST NOT provide DNS
   service until at least one of the DNS privacy servers becomes
   available.

   A DNS privacy server may be temporarily unavailable when configuring
   a network.  For example, for clients on networks that require
   authentication through web-based login, such authentication may rely
   on DNS interception and spoofing.  Techniques such as those used by
   DNSSEC-trigger [dnssec-trigger] MAY be used during network
   configuration, with the intent to transition to the designated DNS
   provider after authentication.  The user MUST be alerted that the DNS
   is not private during such bootstrap.

7.  Out of Band Sources of Reference Identifier

7.1.  Direct configuration

   DNS clients may be directly and securely provisioned with reference
   identifiers e.g. via a configuration file or API.

7.2.  DHCP

   In the future reference identifiers (e.g. certificate names) might be
   available in /etc/resolv.conf.  However this will require assignment
   of a new DHCP option for each reference identifier.

   [QUESTION: Should we discuss in more detail what can go in here?
   Cert name, SPKI fingerprint, etc....]  [QUESTION: Do we want to do
   explore new DHCP options now?]

   This also raises the question of trust in the DHCP server (e.g. while
   roaming), and of the security of the connection to the DHCP server.
   Therefore this mechanism may be limited to only certain environments.

   [NOTE: We talked to the DHCP folks and they stated that they are
   working on securing IPv6, but that they don't expect IPv4 to be
   secured. ]

8.  In Band Sources of Reference Identifier

8.1.  DANE

   DANE [RFC6698] provides mechanisms to root certificate and raw public
   keys trust with DNSSEC.  However this requires a hostname which must
   be obtained via a trusted out of band source.





Dickinson & Reddy         Expires May 13, 2016                  [Page 5]

Internet-Draft            (D)TLS Authentication            November 2015


8.1.1.  Direct DNS Lookup

   The DNS client MAY choose to perform the DNS lookups to retrieve the
   required DANE records itself.  The DNS queries for such DANE records
   MAY use opportunistic encryption or be in the clear to avoid trust
   recursion.

8.1.2.  TLS DNSSEC Chain extension

   Alternatively the TLS extension described in
   [I-D.shore-tls-dnssec-chain-extension] MAY be used if the DNS client
   and server support this.  Several things make this mechanism
   particularly attractive.  In particular it reduces latency by
   obtaining the DANE records during the TLS handshake and these records
   in the TLS handshake will be encrypted in TLS 1.3.

9.  Authentication Profiles

   [THIS SECTION IS NOT FINISHED AND NEEDS LOTS OF WORK!]

9.1.  X.509 Certificate Based Authentication

9.1.1.  Certificate Level Authentication

   The client MAY authenticate properties of the entire certificate:

   o  The complete certificate

   o  The fingerprint of the certificate

9.1.2.  Field Based Authentication

   The client MAY authenticate only certain fields in the certificate.
   Authentication of a single field is acceptable.

   [NOTE: the next sentence is lifted from the DTLS draft.]

   The client MUST use the rules and guidelines given in section 6 of
   [RFC6125] to validate the DNS server identity.

9.1.2.1.  DNS-ID Based Authentication

   In this profile the server certificate MUST contain DNS-ID (
   subjectAltName) as described in Section 4.1 of[RFC6125].  The DNS
   name can be contained in the subjectAltName entries.

9.1.2.2.  Others...




Dickinson & Reddy         Expires May 13, 2016                  [Page 6]

Internet-Draft            (D)TLS Authentication            November 2015


9.2.  Public Key Based Authentication

   The public key is used for the same reasons HTTP pinning [RFC7469]
   uses the public key.  Or, for example, the client policy may specify
   that the only acceptable authentication credential is raw public key
   obtained via DANE.

9.2.1.  SPKI Based Authentication

9.2.2.  Raw Public Key Based Authentication

   Both DNS client and DNS resolver need to support the raw public key-
   based authentication mechanism defined in [RFC7250] can be used by
   the client to authenticate the DNS resolver.

10.  Server capability probing and caching by DNS clients

   Deployment of both DNS-over-TLS and DNS-over-DTLS will be gradual.
   Not all servers will support one or both of these protocols and the
   well-known port might be blocked by some middleboxes.  Clients will
   be expected to keep track of servers that support TLS and/or DTLS,
   and those that have been previously authenticated.

   If no server capability information is available then (unless
   otherwise specified by the configuration of the DNS client) DNS
   clients that implement both TLS and DTLS SHOULD try to authenticate
   using both protocols before failing or falling back to a lower
   security.  DNS clients using opportunistic security SHOULD try all
   available servers in order to obtain an authenticated encrypted
   connection before falling back to a lower security.  (RATIONALE: This
   approach can increase latency while discovering server capabilities
   but maximizes the chance of sending the query over an authenticated
   encrypted connection.)

   [QUESTION: Should we make recommendations about what to do if a
   previously authenticated server starts failing authentication?]

11.  (D)TLS Protocol Profile

   This section defines the protocol profile of DNS-over-DTLS and DNS-
   over-TLS.

   There are known attacks on TLS, such as person-in-the-middle and
   protocol downgrade.  These are general attacks on TLS and not
   specific to DNS-over-TLS; please refer to the TLS RFCs for discussion
   of these security issues.  Clients and servers MUST adhere to the TLS
   implementation recommendations and security considerations of
   [RFC7525] except with respect to TLS version.  Since encryption of



Dickinson & Reddy         Expires May 13, 2016                  [Page 7]

Internet-Draft            (D)TLS Authentication            November 2015


   DNS using (D)TLS is virtually a green-field deployment DNS clients
   and server MUST implement only (D)TLS 1.2 until a higher version is
   available.

   Implementations compliant with this profile MUST implement all of the
   following items:

   o  TLS session resumption without server-side state [RFC5077] which
      eliminates the need for the server to retain cryptographic state
      for longer than necessary.

   o  Raw public keys [RFC7250] which reduce the size of the
      ServerHello, and can be used by clients that cannot obtain
      certificates (e.g., DNS resolvers on private networks).

   Implementations compliant with this profile SHOULD implement all of
   the following items:

   o  TLS False Start [I-D.ietf-tls-falsestart] which reduces round-
      trips by allowing the TLS second flight of messages
      (ChangeCipherSpec) to also contain the (encrypted) DNS query

   o  Cached Information Extension [I-D.ietf-tls-cached-info] which
      avoids transmitting the server's certificate and certificate chain
      if the client has cached that information from a previous TLS
      handshake

   [NOTE: The references to (works in progress) should be upgraded to
   MUST's if those references become RFC's prior to publication of this
   document.]

   Guidance specific to TLS or DTLS is provided in either
   [I-D.ietf-dprive-dnsodtls] or [I-D.ietf-dprive-dns-over-tls].

12.  IANA Considerations

   This memo includes no request to IANA.

13.  Security Considerations

14.  Acknowledgements

15.  References

15.1.  Normative References

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119, March 1997.



Dickinson & Reddy         Expires May 13, 2016                  [Page 8]

Internet-Draft            (D)TLS Authentication            November 2015


   [RFC5077]  Salowey, J., Zhou, H., Eronen, P., and H. Tschofenig,
              "Transport Layer Security (TLS) Session Resumption without
              Server-Side State", RFC 5077, DOI 10.17487/RFC5077,
              January 2008, <http://www.rfc-editor.org/info/rfc5077>.

   [RFC6125]  Saint-Andre, P. and J. Hodges, "Representation and
              Verification of Domain-Based Application Service Identity
              within Internet Public Key Infrastructure Using X.509
              (PKIX) Certificates in the Context of Transport Layer
              Security (TLS)", RFC 6125, DOI 10.17487/RFC6125, March
              2011, <http://www.rfc-editor.org/info/rfc6125>.

   [RFC7250]  Wouters, P., Ed., Tschofenig, H., Ed., Gilmore, J.,
              Weiler, S., and T. Kivinen, "Using Raw Public Keys in
              Transport Layer Security (TLS) and Datagram Transport
              Layer Security (DTLS)", RFC 7250, DOI 10.17487/RFC7250,
              June 2014, <http://www.rfc-editor.org/info/rfc7250>.

   [RFC7525]  Sheffer, Y., Holz, R., and P. Saint-Andre,
              "Recommendations for Secure Use of Transport Layer
              Security (TLS) and Datagram Transport Layer Security
              (DTLS)", BCP 195, RFC 7525, DOI 10.17487/RFC7525, May
              2015, <http://www.rfc-editor.org/info/rfc7525>.

15.2.  Informative References

   [I-D.ietf-dprive-dns-over-tls]
              Zi, Z., Zhu, L., Heidemann, J., Mankin, A., Wessels, D.,
              and P. Hoffman, "DNS over TLS: Initiation and Performance
              Considerations", draft-ietf-dprive-dns-over-tls-01 (work
              in progress), October 2015.

   [I-D.ietf-dprive-dnsodtls]
              Reddy, T., Wing, D., and P. Patil, "DNS over DTLS
              (DNSoD)", draft-ietf-dprive-dnsodtls-02 (work in
              progress), October 2015.

   [I-D.ietf-tls-cached-info]
              Santesson, S. and H. Tschofenig, "Transport Layer Security
              (TLS) Cached Information Extension", draft-ietf-tls-
              cached-info-20 (work in progress), October 2015.

   [I-D.ietf-tls-falsestart]
              Langley, A., Modadugu, N., and B. Moeller, "Transport
              Layer Security (TLS) False Start", draft-ietf-tls-
              falsestart-01 (work in progress), November 2015.

   [I-D.shore-tls-dnssec-chain-extension]



Dickinson & Reddy         Expires May 13, 2016                  [Page 9]

Internet-Draft            (D)TLS Authentication            November 2015


              Shore, M., Barnes, R., Huque, S., and W. Toorop, "A DANE
              Record and DNSSEC Authentication Chain Extension for TLS",
              draft-shore-tls-dnssec-chain-extension-02 (work in
              progress), October 2015.

Appendix A.  Changes between revisions

   [Note to RFC Editor: please remove this section prior to
   publication.]

Authors' Addresses

   Sara Dickinson
   Sinodun Internet Technologies
   Magdalen Centre
   Oxford Science Park
   Oxford  OX4 4GA
   UK

   Email: sara@sinodun.com
   URI:   http://sinodun.com


   Tirumaleswar Reddy
   Cisco Systems, Inc.
   Cessna Business Park, Varthur Hobli
   Sarjapur Marathalli Outer Ring Road
   Bangalore, Karnataka  560103
   India

   Email: tireddy@cisco.com




















Dickinson & Reddy         Expires May 13, 2016                 [Page 10]
